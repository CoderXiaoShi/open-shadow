# æ™ºå½± Â· Open Shadow Admin

ä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿï¼ŒåŸºäº Koa2 + Vue3 + Element Plus + Sequelize + MySQLã€‚
æ ¸å¿ƒåŠŸèƒ½ï¼šç”¨æˆ·æƒé™ç®¡ç† + åšä¸»ç´ æé‡‡é›† + AI Agent å¯¹è¯ã€‚

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (Vue3 + Element Plus)             â”‚
â”‚  ç³»ç»Ÿç®¡ç† â”‚ æ–‡ä»¶ç®¡ç† â”‚ ç´ æç®¡ç† â”‚ Agent ç®¡ç† â”‚ å¯¹è¯ä¸­å¿ƒ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP / REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯ (Koa2 + Node.js)                  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Auth / RBAC â”‚  â”‚ ç´ æ Service â”‚  â”‚  Agent Serviceâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                  â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”           â”‚           â”‚
â”‚  â”‚       CrawlerRegistry         â”‚           â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â”‚ Bilibili â”‚ â”‚  Douyin   â”‚   â”‚     â”‚  LLM API  â”‚    â”‚
â”‚  â”‚  â”‚ Adapter  â”‚ â”‚  Adapter  â”‚ â€¦ â”‚     â”‚  (Claude) â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     MySQL (Sequelize)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—è¯´æ˜

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç”¨æˆ· / è§’è‰² / æƒé™ç®¡ç† | âœ… å·²å®ç° | RBACï¼ŒåŠ¨æ€èœå•ï¼ŒæŒ‰é’®çº§æƒé™ |
| æ–‡ä»¶ç®¡ç† | âœ… å·²å®ç° | æ–‡ä»¶ä¸Šä¼ ä¸ç®¡ç† |
| ç´ æç®¡ç†ï¼ˆBç«™ï¼‰ | ğŸš§ å¼€å‘ä¸­ | é‡‡é›†åšä¸»å†…å®¹ï¼Œæ”¯æŒè‡ªåŠ¨+æ‰‹åŠ¨ |
| ç´ æç®¡ç†ï¼ˆæŠ–éŸ³ï¼‰ | ğŸ“‹ è§„åˆ’ä¸­ | ä»…æ‰‹åŠ¨æäº¤ï¼ˆåçˆ¬å¼ºï¼‰ |
| å…¨å¹³å°æ±‡æ€» | ğŸ“‹ è§„åˆ’ä¸­ | åªè¯»ï¼Œè·¨å¹³å°æ£€ç´¢ |
| Agent ç®¡ç† | ğŸ“‹ è§„åˆ’ä¸­ | åŸºäºç´ ææ„å»ºåšä¸» Agent |
| å¯¹è¯ä¸­å¿ƒ | ğŸ“‹ è§„åˆ’ä¸­ | ä¸ Agent æ–‡å­—å¯¹è¯ |

---

## ç›®å½•ç»“æ„

```
admin/
â”œâ”€â”€ server/                     # åç«¯ï¼ˆKoa2 + Sequelizeï¼‰
â”‚   â”œâ”€â”€ config/                 # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ controllers/            # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ crawlers/               # é‡‡é›†å±‚ï¼ˆæ’ä»¶åŒ–ï¼Œå¯ç‹¬ç«‹è¿è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ index.js            # CrawlerRegistry æ³¨å†Œä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ base.js             # BaseCrawler æŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ bilibili/           # Bç«™ Adapter
â”‚   â”‚   â””â”€â”€ douyin/             # æŠ–éŸ³ Adapterï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ middleware/             # ä¸­é—´ä»¶ï¼ˆauthã€permissionï¼‰
â”‚   â”œâ”€â”€ models/                 # Sequelize æ¨¡å‹
â”‚   â”œâ”€â”€ routes/                 # è·¯ç”±
â”‚   â”œâ”€â”€ scripts/                # å·¥å…·è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ init.js             # â­ æ•°æ®åˆå§‹åŒ–ï¼ˆé¦–æ¬¡éƒ¨ç½²å¿…é¡»æ‰§è¡Œï¼‰
â”‚   â”‚   â””â”€â”€ reset-password.js   # é‡ç½®ç”¨æˆ·å¯†ç 
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ materialService.js  # ç´ æå…¥åº“ï¼ˆå”¯ä¸€å…¥å£ï¼Œä¸æ„ŸçŸ¥å¹³å°ï¼‰
â”‚   â”‚   â”œâ”€â”€ crawlTaskService.js # é‡‡é›†ä»»åŠ¡é˜Ÿåˆ—
â”‚   â”‚   â””â”€â”€ agentService.js     # Agent ä¸Šä¸‹æ–‡æ„å»º
â”‚   â””â”€â”€ index.js                # æœåŠ¡å…¥å£
â””â”€â”€ server-client/              # å‰ç«¯ï¼ˆVue3 + Element Plusï¼‰
    â””â”€â”€ src/
        â”œâ”€â”€ api/                # æ¥å£å°è£…
        â”œâ”€â”€ components/         # å…¬å…±ç»„ä»¶
        â”œâ”€â”€ router/             # è·¯ç”± + è·¯ç”±å®ˆå«
        â”œâ”€â”€ stores/             # Pinia çŠ¶æ€ç®¡ç†
        â””â”€â”€ views/              # é¡µé¢
            â”œâ”€â”€ Material/       # ç´ æç®¡ç†ï¼ˆæŒ‰å¹³å°åˆ†é¡µï¼‰
            â””â”€â”€ Agent/          # Agent ç®¡ç† + å¯¹è¯
```

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

| ä¾èµ– | ç‰ˆæœ¬è¦æ±‚ |
|------|----------|
| Node.js | >= 18 |
| MySQL | >= 8.0 |

### 1. é…ç½®æ•°æ®åº“

åœ¨ MySQL ä¸­åˆ›å»ºæ•°æ®åº“ï¼š

```sql
CREATE DATABASE openShadow CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

ä¿®æ”¹ `server/config/database.js`ï¼š

```js
const sequelize = new Sequelize({
  dialect:  'mysql',
  host:     'localhost',
  port:     3306,
  username: 'root',       // æ•°æ®åº“ç”¨æˆ·å
  password: '12345678',   // æ•°æ®åº“å¯†ç 
  database: 'openShadow'
});
```

### 2. å®‰è£…ä¾èµ–

```bash
# åç«¯
cd server
cnpm install

# å‰ç«¯
cd ../server-client
cnpm install
```

### 3. â­ åˆå§‹åŒ–åŸºç¡€æ•°æ®ï¼ˆé¦–æ¬¡éƒ¨ç½²å¿…é¡»æ‰§è¡Œï¼‰

```bash
cd server
npm run init
```

æ‰§è¡ŒæˆåŠŸåè¾“å‡ºï¼š

```
âœ” æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ” æ•°æ®åº“è¡¨ç»“æ„åŒæ­¥å®Œæˆ

â–¸ åˆå§‹åŒ–è§’è‰²
  [admin] å·²åˆ›å»º
  [user]  å·²åˆ›å»º

â–¸ åˆå§‹åŒ–èœå•æƒé™
  ...

â–¸ åˆå§‹åŒ–ç®¡ç†å‘˜ç”¨æˆ·
  ç”¨æˆ· [admin] å·²åˆ›å»ºï¼Œåˆå§‹å¯†ç : admin123

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ…  åˆå§‹åŒ–å®Œæˆï¼
    ç™»å½•è´¦å·: admin
    åˆå§‹å¯†ç : admin123
    é¦–æ¬¡ç™»å½•åè¯·åŠæ—¶ä¿®æ”¹å¯†ç 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

> **æ³¨æ„**ï¼šinit è„šæœ¬æ˜¯å¹‚ç­‰çš„ï¼Œé‡å¤æ‰§è¡Œä¸ä¼šäº§ç”Ÿé‡å¤æ•°æ®ã€‚

### 4. å¯åŠ¨æœåŠ¡

```bash
# åç«¯ï¼ˆnodemon è‡ªåŠ¨é‡å¯ï¼‰
cd server
npm run dev

# å‰ç«¯
cd server-client
npm run dev
```

è®¿é—®ï¼š`http://localhost:5173`

---

## é»˜è®¤è´¦å·

| å­—æ®µ | å€¼ |
|------|----|
| è´¦å· | `admin` |
| å¯†ç  | `admin123` |

> é¦–æ¬¡ç™»å½•åè¯·ä¿®æ”¹å¯†ç ã€‚

---

## æƒé™è®¾è®¡

### è§’è‰²

| role_code | è¯´æ˜ |
|-----------|------|
| `admin`   | ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰å…¨éƒ¨æƒé™ |
| `user`    | æ™®é€šç”¨æˆ·ï¼ŒæŒ‰éœ€åˆ†é…æƒé™ |

### èœå•æƒé™ï¼ˆtype=1ï¼‰

| permission_code | è·¯ç”± | è¯´æ˜ |
|-----------------|------|------|
| `home`          | `/home`              | é¦–é¡µ |
| `system`        | `/system`            | ç³»ç»Ÿç®¡ç†ï¼ˆçˆ¶èœå•ï¼‰ |
| `system:user`   | `/system/user`       | ç”¨æˆ·ç®¡ç† |
| `system:role`   | `/system/role`       | è§’è‰²ç®¡ç† |
| `system:menu`   | `/system/menu`       | èœå•ç®¡ç† |
| `file`          | `/file`              | æ–‡ä»¶ç®¡ç† |
| `material`      | `/material`          | ç´ æç®¡ç†ï¼ˆçˆ¶èœå•ï¼‰|
| `material:bili` | `/material/bilibili` | Bç«™ç´ æ |
| `material:dy`   | `/material/douyin`   | æŠ–éŸ³ç´ æ |
| `material:all`  | `/material/summary`  | å…¨å¹³å°æ±‡æ€»ï¼ˆåªè¯»ï¼‰|
| `agent`         | `/agent`             | Agent ç®¡ç† |
| `agent:chat`    | `/agent/chat`        | å¯¹è¯ä¸­å¿ƒ |

### æŒ‰é’®æƒé™ï¼ˆtype=2ï¼‰

| permission_code         | è¯´æ˜ |
|-------------------------|------|
| `system:user:add`       | æ–°å¢ç”¨æˆ· |
| `system:user:edit`      | ç¼–è¾‘ç”¨æˆ· |
| `system:user:delete`    | åˆ é™¤ç”¨æˆ· |
| `system:role:add`       | æ–°å¢è§’è‰² |
| `system:role:edit`      | ç¼–è¾‘è§’è‰² |
| `system:role:delete`    | åˆ é™¤è§’è‰² |
| `system:role:assign`    | åˆ†é…æƒé™ |
| `system:menu:add`       | æ–°å¢èœå• |
| `system:menu:edit`      | ç¼–è¾‘èœå• |
| `system:menu:delete`    | åˆ é™¤èœå• |
| `file:upload`           | ä¸Šä¼ æ–‡ä»¶ |
| `file:delete`           | åˆ é™¤æ–‡ä»¶ |
| `material:bili:add`     | Bç«™æ–°å¢åšä¸» |
| `material:bili:crawl`   | Bç«™è§¦å‘é‡‡é›† |
| `material:bili:edit`    | Bç«™ç¼–è¾‘ç´ æ |
| `material:bili:delete`  | Bç«™åˆ é™¤ç´ æ |
| `agent:add`             | æ–°å»º Agent |
| `agent:edit`            | ç¼–è¾‘ Agent |
| `agent:delete`          | åˆ é™¤ Agent |

---

## é‡‡é›†å±‚æ¶æ„

é‡‡é›†å±‚ä¸æ ¸å¿ƒä¸šåŠ¡å®Œå…¨è§£è€¦ï¼Œç³»ç»Ÿå¯åœ¨æ²¡æœ‰ä»»ä½• Adapter çš„æƒ…å†µä¸‹æ­£å¸¸è¿è¡Œï¼ˆçº¯æ‰‹åŠ¨ä¸Šä¼ æ¨¡å¼ï¼‰ã€‚

### è¿è¡Œæ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ |
|------|------|
| çº¯æ‰‹åŠ¨ | `crawlers/` æ—  adapterï¼Œåªèƒ½æ‰‹åŠ¨æäº¤ç´ æ |
| åŠè‡ªåŠ¨ | ä»… Bç«™ adapterï¼ŒæŠ–éŸ³æ‰‹åŠ¨ |
| å…¨è‡ªåŠ¨ | æ‰€æœ‰ adapter æ³¨å†Œï¼Œè‡ªåŠ¨é‡‡é›† + æ‰‹åŠ¨å…œåº• |

### Adapter æ¥å£

æ–°å¢å¹³å°åªéœ€å®ç° `BaseCrawler` å¹¶æ³¨å†Œåˆ° `CrawlerRegistry`ï¼š

```js
class BaseCrawler {
  get name()        { }   // 'bilibili'
  get displayName() { }   // 'Bç«™'
  get urlPattern()  { }   // åŒ¹é…ä¸»é¡µ URL çš„æ­£åˆ™

  validateUrl(url)              // éªŒè¯ URL æ ¼å¼
  extractUserId(url)            // ä» URL æå–åšä¸» ID
  fetchProfile(userId)          // è¿”å›åšä¸»åŸºæœ¬ä¿¡æ¯
  fetchPosts(userId, since)     // è¿”å›è¿‘æœŸä½œå“åˆ—è¡¨
  fetchBloggerReplies(postId)   // è¿”å›åšä¸»å›å¤ç²‰ä¸çš„è¯„è®º
}
```

### å†…å®¹å…¥åº“ç»Ÿä¸€å…¥å£

```
æ‰‹åŠ¨æäº¤  â”€â”
           â†“
Adapter â”€â”€â†’ materialService.addContent() â†’ blogger_contents è¡¨
           â†‘
å…¶ä»–å¹³å° â”€â”€â”˜
```

`materialService` ä¸æ„ŸçŸ¥æ•°æ®æ¥æºï¼Œ`source` å­—æ®µæ ‡è®° `auto_crawl` / `manual`ã€‚

---

## æ ¸å¿ƒæ•°æ®è¡¨

| è¡¨å | è¯´æ˜ |
|------|------|
| `sys_user` | ç³»ç»Ÿç”¨æˆ· |
| `sys_role` | è§’è‰² |
| `sys_permission` | æƒé™ï¼ˆèœå•+æŒ‰é’®ï¼‰ |
| `sys_user_role` | ç”¨æˆ·-è§’è‰²å…³è” |
| `sys_role_permission` | è§’è‰²-æƒé™å…³è” |
| `bloggers` | åšä¸»ä¿¡æ¯ï¼ˆå¹³å°+ä¸»é¡µ+çŠ¶æ€ï¼‰ |
| `blogger_contents` | é‡‡é›†/æ‰‹åŠ¨æäº¤çš„ç´ æå†…å®¹ |
| `crawl_tasks` | é‡‡é›†ä»»åŠ¡é˜Ÿåˆ— |
| `agents` | AI Agent é…ç½® |
| `agent_sessions` | å¯¹è¯ä¼šè¯ |
| `agent_messages` | å¯¹è¯æ¶ˆæ¯ |

---

## å·¥å…·è„šæœ¬

### é‡ç½®ç”¨æˆ·å¯†ç 

```bash
cd server
node scripts/reset-password.js <ç”¨æˆ·å> <æ–°å¯†ç >
```

### é‡æ–°åˆå§‹åŒ–æ•°æ®

```sql
-- è°¨æ…æ“ä½œï¼ä»…å¼€å‘ç¯å¢ƒä½¿ç”¨
TRUNCATE TABLE sys_role_permission;
TRUNCATE TABLE sys_user_role;
TRUNCATE TABLE sys_permission;
TRUNCATE TABLE sys_role;
DELETE FROM sys_user WHERE username = 'admin';
```

```bash
npm run init
```

---

## å¼€å‘è¯´æ˜

### æ–°å¢èœå•

1. åœ¨ `scripts/init.js` çš„ `MENUS` æ•°ç»„ä¸­è¿½åŠ å®šä¹‰
2. åœ¨ `ROLE_PERMISSIONS.admin` ä¸­è¿½åŠ  permission_code
3. åœ¨å‰ç«¯ `router/index.js` ä¸­æ·»åŠ è·¯ç”±
4. æ–°å»ºå¯¹åº” Vue é¡µé¢
5. æ‰§è¡Œ `npm run init`

### æ–°å¢æŒ‰é’®æƒé™

1. åœ¨ `scripts/init.js` çš„ `BUTTONS` ä¸­è¿½åŠ 
2. åœ¨ `ROLE_PERMISSIONS.admin` ä¸­è¿½åŠ 
3. åœ¨åç«¯è·¯ç”±åŠ  `checkPermission('your:code')`
4. åœ¨ Vue é¡µé¢æŒ‰é’®åŠ  `v-if="userStore.hasPermission('your:code')"`
5. æ‰§è¡Œ `npm run init`

### æ–°å¢é‡‡é›†å¹³å°

1. åœ¨ `server/crawlers/` ä¸‹æ–°å»ºå¹³å°ç›®å½•
2. å®ç° `BaseCrawler` æ¥å£
3. åœ¨ `crawlers/index.js` æ³¨å†Œï¼ˆæ¡ä»¶åŠ è½½ï¼‰
4. å‰ç«¯å¹³å°é¡µé¢å‚è€ƒ `views/Material/Bilibili.vue`
